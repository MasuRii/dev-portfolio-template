---
import RootLayout from '../../layouts/RootLayout.astro';
import MainLayout from '../../layouts/MainLayout.astro';
import Section from '../../components/common/Section.astro';
import Container from '../../components/common/Container.astro';
import { ShareButtons } from '../../components/ui/ShareButtons';
import { getBlogData } from '../../lib/data';
import type { BlogPost } from '../../types/blog';

export async function getStaticPaths() {
  const posts = getBlogData();
  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}

interface Props {
  post: BlogPost;
}

const { post } = Astro.props;

// Handle case where post doesn't exist (for SSR mode)
if (!post) {
  return Astro.redirect(`${import.meta.env.BASE_URL}404`);
}

const title = `${post.title} | MasuRii`;
const description = post.excerpt;
const ogImage = post.image;
const articleUrl = new URL(
  `${import.meta.env.BASE_URL}blog/${post.id}`,
  Astro.site || 'https://masurii.dev'
).toString();

// Format the date
const formattedDate = new Date(post.date).toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});

// Article content - In a real app, this would come from a CMS or markdown files
// For now, we generate placeholder content based on the excerpt
const articleContent = `
<p class="lead">${post.excerpt}</p>

<h2>Introduction</h2>
<p>In the ever-evolving landscape of web development, staying ahead of the curve is essential. This article explores key concepts and practical strategies that can elevate your development workflow and the user experiences you create.</p>

<p>The modern web demands more than just functional code. It requires a deep understanding of performance, accessibility, and user experience principles that together create truly exceptional digital products.</p>

<h2>Key Concepts</h2>
<p>Understanding the fundamentals is crucial before diving into advanced techniques. Let's explore the core concepts that form the foundation of this topic.</p>

<blockquote>
  <p>"The best code is no code at all. Every new line of code you willingly bring into the world is code that has to be debugged, code that has to be read and understood, code that has to be supported."</p>
  <cite>- Jeff Atwood</cite>
</blockquote>

<p>When we approach development with this mindset, we naturally gravitate toward simpler, more maintainable solutions. This philosophy aligns perfectly with modern frameworks that emphasize developer experience without sacrificing performance.</p>

<h2>Practical Implementation</h2>
<p>Theory is valuable, but practical application is where real learning happens. Here are some strategies you can implement in your projects today:</p>

<ul>
  <li>Start with a solid foundation - choose the right tools for your specific use case</li>
  <li>Measure performance early and often - what gets measured gets improved</li>
  <li>Prioritize user experience - every technical decision should serve the end user</li>
  <li>Iterate and refine - perfection is achieved through continuous improvement</li>
</ul>

<h2>Looking Forward</h2>
<p>The web platform continues to evolve at a rapid pace. Staying informed about emerging standards and best practices ensures that your skills remain relevant and your projects continue to deliver value.</p>

<p>Whether you're building a personal portfolio, a complex web application, or anything in between, the principles discussed here will serve you well on your development journey.</p>
`;
---

<RootLayout
  title={title}
  description={description}
  ogImage={ogImage}
  showReadingProgress={true}
>
  <MainLayout>
    <article class="bg-background">
      <!-- Hero Section -->
      <div class="relative h-[50vh] min-h-[400px] overflow-hidden">
        <img
          src={post.image}
          alt={post.title}
          class="w-full h-full object-cover"
          loading="eager"
        />
        <div
          class="absolute inset-0 bg-gradient-to-t from-background via-background/60 to-transparent"
        >
        </div>
      </div>

      <Section variant="background" class="!pt-0 -mt-32 relative z-10">
        <Container class="max-w-4xl">
          <!-- Back Link -->
          <a
            href={`${import.meta.env.BASE_URL}blog`}
            class="inline-flex items-center gap-2 text-secondary hover:text-accent transition-colors mb-8 animate-item"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              aria-hidden="true"
            >
              <path d="m12 19-7-7 7-7"></path>
              <path d="M19 12H5"></path>
            </svg>
            Back to Articles
          </a>

          <!-- Article Header -->
          <header class="mb-12 animate-item">
            <div class="flex flex-wrap gap-2 mb-6">
              {
                post.tags.map((tag) => (
                  <span class="rounded-full bg-surface px-4 py-1.5 text-sm font-medium text-secondary border border-border">
                    {tag}
                  </span>
                ))
              }
            </div>

            <h1
              class="font-display text-h1 md:text-display font-bold text-primary mb-6 leading-tight"
            >
              {post.title}
            </h1>

            <div
              class="flex flex-wrap items-center gap-4 text-secondary border-b border-border pb-8"
            >
              <time datetime={post.date} class="flex items-center gap-2">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  aria-hidden="true"
                >
                  <rect width="18" height="18" x="3" y="4" rx="2" ry="2"></rect>
                  <line x1="16" x2="16" y1="2" y2="6"></line>
                  <line x1="8" x2="8" y1="2" y2="6"></line>
                  <line x1="3" x2="21" y1="10" y2="10"></line>
                </svg>
                {formattedDate}
              </time>
              <span class="flex items-center gap-2">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  aria-hidden="true"
                >
                  <circle cx="12" cy="12" r="10"></circle>
                  <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                {post.readTime}
              </span>
              <div class="ml-auto">
                <ShareButtons
                  client:visible
                  title={post.title}
                  url={articleUrl}
                  excerpt={post.excerpt}
                />
              </div>
            </div>
          </header>

          <!-- Article Content -->
          <div class="prose animate-item" set:html={articleContent} />

          <!-- Article Footer -->
          <footer class="mt-16 pt-8 border-t border-border animate-item">
            <div
              class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"
            >
              <div>
                <p class="text-secondary text-sm mb-2">Share this article</p>
                <ShareButtons
                  client:visible
                  title={post.title}
                  url={articleUrl}
                  excerpt={post.excerpt}
                />
              </div>
              <a
                href={`${import.meta.env.BASE_URL}blog`}
                class="inline-flex items-center gap-2 px-6 py-3 bg-surface border border-border rounded-lg text-primary font-medium hover:border-accent hover:text-accent transition-colors"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  aria-hidden="true"
                >
                  <path d="m12 19-7-7 7-7"></path>
                  <path d="M19 12H5"></path>
                </svg>
                More Articles
              </a>
            </div>
          </footer>
        </Container>
      </Section>
    </article>
  </MainLayout>
</RootLayout>
